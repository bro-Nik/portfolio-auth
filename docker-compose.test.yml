services:
  auth-db:
    extends:
      file: docker-compose.base.yml
      service: auth-db
    container_name: auth-db-test
    networks:
      - auth-net

  auth-test:
    extends:
      file: docker-compose.base.yml
      service: auth
    build:
      context: .
      dockerfile: Dockerfile.test
    environment:
      TEST_DATABASE_URL: postgresql+asyncpg://auth_user:auth_pass@auth-db/auth_db
    container_name: auth-test
    volumes:
      - ./app:/app/app
      - ./tests:/app/tests
      - ./requirements.txt:/app/requirements.txt
      - ./requirements-test.txt:/app/requirements-test.txt
      - ./reports:/app/reports
    networks:
      - auth-net
    command: ["pytest"]

networks:
  auth-net:
    driver: bridge

volumes:
  db_data:
  reports:
